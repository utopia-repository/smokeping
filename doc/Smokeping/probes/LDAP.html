<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Smokeping/probes/LDAP</title>
<link rev="made" href="mailto:dws@ee.ethz.ch" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->
<!--

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#overview">OVERVIEW</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#variables">VARIABLES</a></li>
	<li><a href="#authors">AUTHORS</a></li>
	<li><a href="#bugs">BUGS</a></li>
</ul>
-->
<!-- INDEX END -->

<p>
</p>
<h1><a name="name">NAME</a></h1>
<p>Smokeping::probes::LDAP - a LDAP probe for SmokePing</p>
<p>
</p>
<hr />
<h1><a name="overview">OVERVIEW</a></h1>
<p>Measures LDAP search latency for SmokePing</p>
<p>
</p>
<hr />
<h1><a name="synopsis">SYNOPSIS</a></h1>
<pre>
 *** Probes ***</pre>
<pre>
 +LDAP</pre>
<pre>
 forks = 5
 offset = 50%
 passwordfile = /some/place/secret
 step = 300</pre>
<pre>
 # The following variables can be overridden in each target section
 attrs = uid,someotherattr
 base = dc=foo,dc=bar
 binddn = uid=testuser,dc=foo,dc=bar
 filter = uid=testuser # mandatory
 mininterval = 1
 password = mypass
 pings = 5
 port = 389
 start_tls = 1
 timeout = 10
 version = 3</pre>
<pre>
 # [...]</pre>
<pre>
 *** Targets ***</pre>
<pre>
 probe = LDAP # if this should be the default probe</pre>
<pre>
 # [...]</pre>
<pre>
 + mytarget
 # probe = LDAP # if the default probe is something else
 host = my.host
 attrs = uid,someotherattr
 base = dc=foo,dc=bar
 binddn = uid=testuser,dc=foo,dc=bar
 filter = uid=testuser # mandatory
 mininterval = 1
 password = mypass
 pings = 5
 port = 389
 start_tls = 1
 timeout = 10
 version = 3</pre>
<p>
</p>
<hr />
<h1><a name="description">DESCRIPTION</a></h1>
<p>This probe measures LDAP query latency for SmokePing.
The query is specified by the target-specific variable `filter' and,
optionally, by the target-specific variable `base'. The attributes 
queried can be specified in the comma-separated list `attrs'.</p>
<p>The TCP port of the LDAP server and the LDAP version to be used can
be specified by the variables `port' and `version'.</p>
<p>The probe can issue the starttls command to convert the connection
into encrypted mode, if so instructed by the `start_tls' variable.
This requires the 'IO::Socket::SSL' perl module to be installed.</p>
<p>The probe can also optionally do an authenticated LDAP bind, if the `binddn'
variable is present. The password to be used can be specified by the
target-specific variable `password' or in an external file.
The location of this file is given in the probe-specific variable
`passwordfile'. See Smokeping::probes::passwordchecker(3pm) for the format
of this file (summary: colon-separated triplets of the form
`&lt;host&gt;:&lt;bind-dn&gt;:&lt;password&gt;')</p>
<p>The probe tries to be nice to the server and does not send authentication
requests more frequently than once every X seconds, where X is the value
of the target-specific ``min_interval'' variable (1 by default).</p>
<p>
</p>
<hr />
<h1><a name="variables">VARIABLES</a></h1>
<p>Supported probe-specific variables:</p>
<dl>
<dt><strong><a name="item_forks">forks</a></strong><br />

</dt><dd>
Run this many concurrent processes at maximum

</dd><dd>
<p>Example value: 5</p>

</dd><dd>
<p>Default value: 5</p>

<p></p>
</dd><dt><strong><a name="item_offset">offset</a></strong><br />

</dt><dd>
If you run many probes concurrently you may want to prevent them from
hitting your network all at the same time. Using the probe-specific
offset parameter you can change the point in time when each probe will
be run. Offset is specified in % of total interval, or alternatively as
'random', and the offset from the 'General' section is used if nothing
is specified here. Note that this does NOT influence the rrds itself,
it is just a matter of when data acqusition is initiated.
(This variable is only applicable if the variable 'concurrentprobes' is set
in the 'General' section.)

</dd><dd>
<p>Example value: 50%</p>

<p></p>
</dd><dt><strong><a name="item_passwordfile">passwordfile</a></strong><br />

</dt><dd>
Location of the file containing usernames and passwords.

</dd><dd>
<p>Example value: /some/place/secret</p>

<p></p>
</dd><dt><strong><a name="item_step">step</a></strong><br />

</dt><dd>
Duration of the base interval that this probe should use, if different
from the one specified in the 'Database' section. Note that the step in
the RRD files is fixed when they are originally generated, and if you
change the step parameter afterwards, you'll have to delete the old RRD
files or somehow convert them. (This variable is only applicable if
the variable 'concurrentprobes' is set in the 'General' section.)

</dd><dd>
<p>Example value: 300</p>

<p></p></dd></dl>
<p>Supported target-specific variables:</p>
<dl>
<dt><strong><a name="item_attrs">attrs</a></strong><br />

</dt><dd>
The attributes queried.

</dd><dd>
<p>Example value: uid,someotherattr</p>

<p></p>
</dd><dt><strong><a name="item_base">base</a></strong><br />

</dt><dd>
The base to be used in the LDAP query

</dd><dd>
<p>Example value: dc=foo,dc=bar</p>

<p></p>
</dd><dt><strong><a name="item_binddn">binddn</a></strong><br />

</dt><dd>
If present, authenticate the LDAP bind with this DN.

</dd><dd>
<p>Example value: uid=testuser,dc=foo,dc=bar</p>

<p></p>
</dd><dt><strong><a name="item_filter">filter</a></strong><br />

</dt><dd>
The actual search to be made

</dd><dd>
<p>Example value: uid=testuser</p>

</dd><dd>
<p>This setting is mandatory.</p>

<p></p>
</dd><dt><strong><a name="item_mininterval">mininterval</a></strong><br />

</dt><dd>
The minimum interval between each query sent, in (possibly fractional) second
s.

</dd><dd>
<p>Default value: 1</p>

<p></p>
</dd><dt><strong><a name="item_password">password</a></strong><br />

</dt><dd>
The password to be used, if not present in &lt;passwordfile&gt;.

</dd><dd>
<p>Example value: mypass</p>

<p></p>
</dd><dt><strong><a name="item_pings">pings</a></strong><br />

</dt><dd>
How many pings should be sent to each target, if different from the global
value specified in the Database section. Note that the number of pings in
the RRD files is fixed when they are originally generated, and if you
change this parameter afterwards, you'll have to delete the old RRD
files or somehow convert them.

</dd><dd>
<p>Example value: 5</p>

<p></p>
</dd><dt><strong><a name="item_port">port</a></strong><br />

</dt><dd>
TCP port of the LDAP server

</dd><dd>
<p>Example value: 389</p>

<p></p>
</dd><dt><strong><a name="item_start_tls">start_tls</a></strong><br />

</dt><dd>
If true, encrypt the connection with the starttls command. Disabled by default.

</dd><dd>
<p>Example value: 1</p>

<p></p>
</dd><dt><strong><a name="item_timeout">timeout</a></strong><br />

</dt><dd>
LDAP query timeout in seconds.

</dd><dd>
<p>Example value: 10</p>

</dd><dd>
<p>Default value: 5</p>

<p></p>
</dd><dt><strong><a name="item_version">version</a></strong><br />

</dt><dd>
The LDAP version to be used.

</dd><dd>
<p>Example value: 3</p>

<p></p></dd></dl>
<p>
</p>
<hr />
<h1><a name="authors">AUTHORS</a></h1>
<p>Niko Tyni &lt;<a href="mailto:ntyni@iki.fi">ntyni@iki.fi</a>&gt;</p>
<p>
</p>
<hr />
<h1><a name="bugs">BUGS</a></h1>
<p>There should be a way of specifying TLS options, such as the certificates
involved etc.</p>
<p>The probe has an ugly way of working around the fact that the 
IO::Socket::SSL class complains if <a href="#item_start_tls"><code>start_tls()</code></a> is done more than once
in the same program. But It Works For Me (tm).</p>

</body>

</html>
